<html>

<head>
    <title>delete</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <style type="text/css">
        .cell {
            display: inline-block;
            background-color: #666666;
            border-radius: 10px;
            margin: 10px;
            padding: 10px;
        }

        video {
            width: 320px;

        }
    </style>
</head>

<body>
    <div id="list"></div>

    <div id="response"></div>

    <script type="text/javascript">
        var playlist = [];

        loadPlaylist();

        function loadPlaylist() {
            $.ajax({
                url: 'files',
                type: 'get',
                dataType: 'json',
                timeout: 3000,
            }).done(function (data) {
                console.dir(data);
                playlist = data.list;
                setList();
                document.getElementById('response').innerText = JSON.stringify(data);
            }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                console.log("error");
            });
        }

        function setList() {
            var html = '';
            var n = playlist.length;
            for (var i = 0; i < n; i++) {
                html += '<div class="cell">';
                html += '<video src="files/' + playlist[i] + '" poster="files/' + playlist[i] +
                    '.jpg" preload="none" controls></video>';
                html += '<br>';
                html += playlist[i] + '<br>';
                html += '<button onclick="onDelete(' + i + ')">削除</button>';
                html += '</div>';
            }
            $('#list').html(html);
        }

        function onDelete(index) {
            console.log("onDelete", index);

            $.ajax({
                    url: "files/" + playlist[index],
                    type: "DELETE",
                    processData: false,
                    contentType: false
                })
                .done(function (data) {
                    console.dir(data);
                    if (data.status == 'success') {
                        loadPlaylist();
                    }
                    document.getElementById('response').innerText = JSON.stringify(data);
                });
        }
    </script>

</body>

</html>